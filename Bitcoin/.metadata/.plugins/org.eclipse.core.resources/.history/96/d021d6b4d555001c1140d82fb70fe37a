package com.trade.coin.model;

import java.io.IOException;
import java.util.ArrayList;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

import com.neovisionaries.ws.client.WebSocket;
import com.neovisionaries.ws.client.WebSocketAdapter;
import com.neovisionaries.ws.client.WebSocketException;
import com.neovisionaries.ws.client.WebSocketFactory;
import com.trade.coin.model.dto.Coin;

public class BitWebSocketAccount {	 
    private static final String SERVER = "wss://api.upbit.com/websocket/v1";
    public void connection(ArrayList<Coin> coinList) throws IOException, WebSocketException
    {
        // Connect to the echo server.
        WebSocket ws = new WebSocketFactory()
        .setConnectionTimeout(5000)
        .createSocket(SERVER)
        .addListener(new WebSocketAdapter() {
            // A text message arrived from the server.
        	@Override
        	public void onBinaryMessage(WebSocket websocket, byte[] binary) throws ParseException {
              String result = new String(binary);
              System.out.println(result);
               
              JSONParser jsonParse = new JSONParser();
        	  JSONObject jsonObj = (JSONObject)jsonParse.parse(result);
        	  System.out.println((String) jsonObj.get("cd"));
            }
        }).connect();
        
        while(true) {
	        //ticker - 현재가, trade - 체결, orderbook - 호가 
	        for (int i = 0; i < coinList.size(); i++) {
	        	//"[{\"ticket\":\"test\"},{\"type\":\"ticker\",\"codes\":[\"KRW-BTC\"]},{\"format\":\"SIMPLE\"}]"
	        	String input = "[{\"ticket\":\"test\"},{\"type\":\"ticker\",\"codes\":[\""
	        			+ coinList.get(i).getMarket()
	        			+ "\"]},{\"format\":\"SIMPLE\"}]";
	        	ws.sendText(input);
			}
        }
     }
}